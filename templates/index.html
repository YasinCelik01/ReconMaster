<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ReconMaster</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body>
  <div class="matrix-bg"></div>
  <div class="container mt-5">
    <div class="text-center mb-4">
      <h1 class="display-4 glitch" data-text="üïµÔ∏è ReconMaster">üïµÔ∏è ReconMaster</h1>
      <p class="lead">Advanced Reconnaissance Suite for Ethical Hackers</p>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ FORM CARD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="row justify-content-center">
      <div class="col-md-10">
        <div class="card">
          <div class="card-body">

            <form method="POST" action="/">
              <!-- URL + ge√ßmi≈ü sonu√ß dropdown‚Äôu -->
              <div class="mb-3">
                <label for="url" class="form-label">Target URL or Domain</label>
                <div class="input-group">
                  <input type="text" class="form-control" id="url" name="url"
                         placeholder="example.com" required>
                  <button class="btn btn-outline-secondary dropdown-toggle"
                          type="button" data-bs-toggle="dropdown"
                          aria-expanded="false"></button>
                  <ul class="dropdown-menu dropdown-menu-end">
                    {% for f in files %}
                      <li><a class="dropdown-item"
                             href="{{ url_for('index', results_file=f.name) }}">
                             {{ f.display }}
                          </a></li>
                    {% endfor %}
                  </ul>
                </div>
              </div>

              <!-- Module selection -->
              <div class="row">
                <!-- Passive -->
                <div class="col-md-4">
                  <fieldset class="mb-3">
                    <legend>Passive Modules</legend>
                    {% set passive_mods = [
                        ('whois','WHOIS'), ('dns','DNS'), ('subfinder','Subfinder'),
                        ('shosubgo','ShosubGo'), ('github','GitHub Subdomains'),
                        ('wayback','Wayback'), ('smap','Shodan Port Scan'),
                        ('googledorks','Google Dorks')
                    ] %}
                    {% for val,label in passive_mods %}
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                               name="modules" value="{{ val }}" id="m_{{ val }}" checked>
                        <label class="form-check-label" for="m_{{ val }}">{{ label }}</label>
                      </div>
                    {% endfor %}
                  </fieldset>
                </div>

                <!-- Active -->
                <div class="col-md-4">
                  <fieldset class="mb-3">
                    <legend>Active Modules</legend>
                    {% set active_mods = [
                        ('katana','Katana'), ('linkfinder','JS LinkFinder'),
                        ('nmap','Nmap'), ('wappalyzer','Wappalyzer'), ('waf','WAFW00f')
                    ] %}
                    {% for val,label in active_mods %}
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                               name="modules" value="{{ val }}" id="m_{{ val }}" checked>
                        <label class="form-check-label" for="m_{{ val }}">{{ label }}</label>
                      </div>
                    {% endfor %}
                  </fieldset>
                </div>

                <!-- Post-Scan -->
                <div class="col-md-4">
                  <fieldset class="mb-3">
                    <legend>Post-Scan Modules</legend>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox"
                             name="modules" value="httpx" id="m_httpx">
                      <label class="form-check-label" for="m_httpx">HTTPX Scan</label>
                    </div>
                    <div class="form-check mt-2">
                      <input class="form-check-input" type="checkbox"
                             name="modules" value="telegram" id="m_tg">
                      <label class="form-check-label" for="m_tg">Telegram Notify</label>
                    </div>
                  </fieldset>
                </div>
              </div>

              <div class="text-center">
                <button class="btn btn-primary" type="submit" onclick="showLoading()">
                  <i class="bi bi-search"></i> Start Reconnaissance
                </button>
              </div>
            </form>

          </div>
        </div>

        <!-- Loading spinner -->
        <div id="loading" class="loading">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <p class="mt-2">Running reconnaissance... This may take a few minutes.</p>
        </div>

        <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ RESULTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
        {% if results %}
        {% set has_active = results.active.endpoints or results.active.open_ports
                            or results.active.waf or results.active.wappalyzer %}
        {% set has_httpx  = results.passive.httpx %}
        {% set cols = 1 + (1 if has_active else 0) + (1 if has_httpx else 0) %}
        {% set col = 'col-lg-' ~ (12 // cols) %}
        <div class="result-section mt-4">
          <h3>Results for <span class="timestamp">{{ header_timestamp }}</span></h3>

          <div class="row gy-4">
            <!-- PASSIVE -->
            <div class="{{ col }}">
              <h4>Passive Reconnaissance</h4>
              <div class="accordion" id="passiveAcc">
                {% if results.passive.whois_result %}
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button" data-bs-toggle="collapse"
                            data-bs-target="#whoisC">WHOIS Information</button>
                  </h2>
                  <div id="whoisC" class="accordion-collapse collapse show"
                       data-bs-parent="#passiveAcc">
                    <div class="accordion-body">
                      <pre>{{ results.passive.whois_result }}</pre>
                    </div>
                  </div>
                </div>
                {% endif %}

                {% if results.passive.dns_info %}
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button collapsed" data-bs-toggle="collapse"
                            data-bs-target="#dnsC">DNS Information</button>
                  </h2>
                  <div id="dnsC" class="accordion-collapse collapse"
                       data-bs-parent="#passiveAcc">
                    <div class="accordion-body">
                      <div class="table-responsive">
                        <table class="table table-striped table-sm">
                          <thead><tr><th>#</th><th>Type</th><th>Source/Domain</th><th>Target/IP</th></tr></thead>
                          <tbody>
                            {% for r in results.passive.dns_info.records %}
                              <tr>
                                <td>{{ loop.index }}</td>
                                <td>{{ r.type }}</td>
                                <td>{{ r.type=='CNAME' and r.source or r.domain }}</td>
                                <td>{{ r.type=='CNAME' and r.target or r.ip }}</td>
                              </tr>
                            {% endfor %}
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
                {% endif %}

                {% if results.passive.subdomains %}
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button collapsed" data-bs-toggle="collapse"
                            data-bs-target="#subsC">Subdomains ({{ results.passive.subdomains|length }})</button>
                  </h2>
                  <div id="subsC" class="accordion-collapse collapse"
                       data-bs-parent="#passiveAcc">
                    <div class="accordion-body">
                      <div class="table-responsive">
                        <table class="table table-striped table-sm">
                          <thead><tr><th>#</th><th>Subdomain</th></tr></thead>
                          <tbody>
                            {% for s in results.passive.subdomains %}
                              <tr><td>{{ loop.index }}</td><td>{{ s }}</td></tr>
                            {% endfor %}
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
                {% endif %}

                {% if results.passive.endpoints %}
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button collapsed" data-bs-toggle="collapse"
                            data-bs-target="#pendC">Passive Endpoints ({{ results.passive.endpoints|length }})</button>
                  </h2>
                  <div id="pendC" class="accordion-collapse collapse"
                       data-bs-parent="#passiveAcc">
                    <div class="accordion-body">
                      <div class="table-responsive">
                        <table class="table table-striped table-sm">
                          <thead><tr><th>#</th><th>Endpoint</th></tr></thead>
                          <tbody>
                            {% for e in results.passive.endpoints %}
                              <tr><td>{{ loop.index }}</td><td>{{ e }}</td></tr>
                            {% endfor %}
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
                {% endif %}

                {% if results.passive.open_ports %}
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button collapsed" data-bs-toggle="collapse"
                            data-bs-target="#pportC">Open Ports ({{ results.passive.open_ports|length }})</button>
                  </h2>
                  <div id="pportC" class="accordion-collapse collapse"
                       data-bs-parent="#passiveAcc">
                    <div class="accordion-body">
                      <div class="table-responsive">
                        <table class="table table-striped table-sm">
                          <thead><tr><th>#</th><th>Port</th></tr></thead>
                          <tbody>
                            {% for p in results.passive.open_ports %}
                              <tr><td>{{ loop.index }}</td><td>{{ p }}</td></tr>
                            {% endfor %}
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
                {% endif %}
              </div>
            </div><!-- /PASSIVE -->

            <!-- ACTIVE -->
            {% if has_active %}
            <div class="{{ col }}">
              <h4>Active Reconnaissance</h4>
              <div class="accordion" id="activeAcc">
                {% if results.active.endpoints %}
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button" data-bs-toggle="collapse"
                            data-bs-target="#aendC">Endpoints ({{ results.active.endpoints|length }})</button>
                  </h2>
                  <div id="aendC" class="accordion-collapse collapse show"
                       data-bs-parent="#activeAcc">
                    <div class="accordion-body">
                      <div class="table-responsive">
                        <table class="table table-striped table-sm">
                          <thead><tr><th>#</th><th>Endpoint</th></tr></thead>
                          <tbody>
                            {% for e in results.active.endpoints %}
                              <tr><td>{{ loop.index }}</td><td>{{ e }}</td></tr>
                            {% endfor %}
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
                {% endif %}

                {% if results.active.open_ports %}
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button collapsed" data-bs-toggle="collapse"
                            data-bs-target="#aportC">Open Ports ({{ results.active.open_ports|length }})</button>
                  </h2>
                  <div id="aportC" class="accordion-collapse collapse"
                       data-bs-parent="#activeAcc">
                    <div class="accordion-body">
                      <div class="table-responsive">
                        <table class="table table-striped table-sm">
                          <thead><tr><th>#</th><th>Port</th></tr></thead>
                          <tbody>
                            {% for p in results.active.open_ports %}
                              <tr><td>{{ loop.index }}</td><td>{{ p }}</td></tr>
                            {% endfor %}
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
                {% endif %}

                {% if results.active.waf %}
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button collapsed" data-bs-toggle="collapse"
                            data-bs-target="#wafC">WAF Information</button>
                  </h2>
                  <div id="wafC" class="accordion-collapse collapse"
                       data-bs-parent="#activeAcc">
                    <div class="accordion-body">
                      <pre>{{ results.active.waf }}</pre>
                    </div>
                  </div>
                </div>
                {% endif %}

                {% if results.active.wappalyzer %}
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button collapsed" data-bs-toggle="collapse"
                            data-bs-target="#techC">Technologies (Wappalyzer)</button>
                  </h2>
                  <div id="techC" class="accordion-collapse collapse"
                       data-bs-parent="#activeAcc">
                    <div class="accordion-body">
                      <pre>{{ results.active.wappalyzer|tojson(indent=2) }}</pre>
                    </div>
                  </div>
                </div>
                {% endif %}
              </div>
            </div>
            {% endif %}

            <!-- POST-SCAN / HTTPX -->
            {% if has_httpx %}
            <div class="{{ col }} flex-grow-1">
              <h4>Post-Scan</h4>
              <div class="accordion" id="postAcc">
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button" data-bs-toggle="collapse"
                            data-bs-target="#httpxC">
                      HTTPX Scan ({{ results.passive.httpx|length }} hosts)
                    </button>
                  </h2>
                  <div id="httpxC" class="accordion-collapse collapse show"
                      data-bs-parent="#postAcc">
                    <div class="accordion-body">
                      <div class="table-responsive">
                        <table class="table table-striped table-sm">
                          <thead>
                            <tr>
                              <th>#</th><th>Host</th><th>Status</th>
                              <th>Title / Error</th><th>Length</th><th>Tech</th>
                            </tr>
                          </thead>
                          <tbody>
                            {% for r in results.passive.httpx %}
                            <tr>
                              <td>{{ loop.index }}</td>
                              <td>{{ r.input }}</td>
                              <td>{% if not r.failed %}{{ r.status_code }}{% endif %}</td>
                              <td>
                                {% if r.failed %}
                                  <span class="text-danger">{{ r.error }}</span>
                                {% else %}
                                  {{ r.title }}
                                {% endif %}
                              </td>
                              <td>{{ r.content_length or 0 }}</td>
                              <td>{% if r.tech %}{{ r.tech|join(', ') }}{% endif %}</td>
                            </tr>
                            {% endfor %}
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            {% endif %}

          </div><!-- /row -->
        </div><!-- /result-section -->
        {% endif %}

      </div><!-- /col-md-10 -->
    </div><!-- /row -->
  </div><!-- /container -->

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
